<template>
  <div class="conten-details">
    <div>
      <div class="section">
        <div class="location">
          <span>ÂΩìÂâç‰ΩçÁΩÆÔºö</span>
          <a href="/index.html">È¶ñÈ°µ</a> &gt;
          <a href="/goods.html">Ë¥≠Áâ©ÂïÜÂüé</a> &gt;
          <a href="/goods/42/1.html">ÂïÜÂìÅËØ¶ÊÉÖ</a>
        </div>
      </div>
      <div class="section">
        <div class="wrapper clearfix">
          <div class="wrap-box">
            <div class="left-925">
              <div class="goods-box clearfix">
                <div class="pic-box">
                  <!-- ÊîæÂ§ßÈïú -->
                  <ProductZoomer
                    v-if="images.normal_size.length!=0"
                    :base-images="images"
                    :base-zoomer-options="zoomerOptions"
                  />
                </div>
                <div class="goods-spec">
                  <h1>{{goodsinfo.title}}</h1>
                  <p class="subtitle">{{goodsinfo.sub_title}}</p>
                  <div class="spec-box">
                    <dl>
                      <dt>Ë¥ßÂè∑</dt>
                      <dd id="commodityGoodsNo">{{goodsinfo.goods_no}}</dd>
                    </dl>
                    <dl>
                      <dt>Â∏ÇÂú∫‰ª∑</dt>
                      <dd>
                        <s id="commodityMarketPrice">¬•{{goodsinfo.market_price}}</s>
                      </dd>
                    </dl>
                    <dl>
                      <dt>ÈîÄÂîÆ‰ª∑</dt>
                      <dd>
                        <em id="commoditySellPrice" class="price">¬•{{goodsinfo.sell_price}}</em>
                      </dd>
                    </dl>
                  </div>
                  <div class="spec-box">
                    <dl>
                      <dt>Ë¥≠‰π∞Êï∞Èáè</dt>
                      <dd>
                        <div class="stock-box">
                          <div class="el-input-number el-input-number--small">
                            <el-input-number
                              v-model="buycount"
                              :min="1"
                              :max="goodsinfo.stock_quantity"
                              label="ÊèèËø∞ÊñáÂ≠ó"
                            ></el-input-number>
                          </div>
                        </div>
                        <span class="stock-txt">
                          Â∫ìÂ≠ò
                          <em id="commodityStockNum">{{goodsinfo.stock_quantity}}</em>‰ª∂
                        </span>
                      </dd>
                    </dl>
                    <dl>
                      <dd>
                        <div id="buyButton" class="btn-buy">
                            
                          <button  class="buy">Á´ãÂç≥Ë¥≠‰π∞</button>
                          <button @click="add2cart" class="add">Âä†ÂÖ•Ë¥≠Áâ©ËΩ¶</button>
                        </div>
                      </dd>
                    </dl>
                  </div>
                </div>
              </div>
              <div id="goodsTabs" class="goods-tab bg-wrap">
                <!-- ‰ΩøÁî®iviewÂõæÈíâ -->
                <Affix>
                  <div
                    id="tabHead"
                    class="tab-head"
                    style="position: static; top: 517px; width: 925px;"
                  >
                    <ul>
                      <li>
                        <a
                          href="javascript:;"
                          :class="{selected:tab=='fist'}"
                          @click="tab='fist'"
                        >ÂïÜÂìÅ‰ªãÁªç</a>
                      </li>
                      <li>
                        <a
                          href="javascript:;"
                          :class="{selected:tab=='tow'}"
                          @click="tab='tow'"
                        >ÂïÜÂìÅËØÑËÆ∫</a>
                      </li>
                    </ul>
                  </div>
                </Affix>
                <div
                  class="tab-content entry"
                  style="display: block;"
                  v-show="tab=='fist'"
                  v-html="goodsinfo.content"
                ></div>
                <div class="tab-content" style="display: block;" v-show="tab=='tow'">
                  <div class="comment-box">
                    <div id="commentForm" name="commentForm" class="form-box">
                      <div class="avatar-box">
                        <i class="iconfont icon-user-full"></i>
                      </div>
                      <div class="conn-box">
                        <div class="editor">
                          <textarea
                            v-model.trim="comment"
                            id="txtContent"
                            name="txtContent"
                            sucmsg=" "
                            data-type="*10-1000"
                            nullmsg="ËØ∑Â°´ÂÜôËØÑËÆ∫ÂÜÖÂÆπÔºÅ"
                          ></textarea>
                          <span class="Validform_checktip"></span>
                        </div>
                        <div class="subcon">
                          <input
                            id="btnSubmit"
                            name="submit"
                            @click="addPinLun"
                            type="submit"
                            value="Êèê‰∫§ËØÑËÆ∫"
                            class="submit"
                          >
                          <span class="Validform_checktip"></span>
                        </div>
                      </div>
                    </div>
                    <p
                      v-show="totalcount==0"
                      style="margin: 5px 0px 15px 69px; line-height: 42px; text-align: center; border: 1px solid rgb(247, 247, 247);"
                    >ÊöÇÊó†ËØÑËÆ∫ÔºåÂø´Êù•Êä¢Ê≤ôÂèëÂêßÔºÅ</p>
                    <ul id="commentList" class="list-box" v-show="totalcount!=0">
                      <li v-for="(item, index) in contenInof" :key="item.article_id">
                        <div class="avatar-box">
                          <i class="iconfont icon-user-full"></i>
                        </div>
                        <div class="inner-box">
                          <div class="info">
                            <span>{{item.user_name}}</span>
                            <span>{{item.add_time | shortTimes }}</span>
                          </div>
                          <p>{{item.content}}</p>
                        </div>
                      </li>
                    </ul>
                    <div class="page-box" style="margin: 5px 0px 0px 62px;">
                      <div id="pagination" class="digg">
                        <el-pagination
                          @size-change="handleSizeChange"
                          @current-change="handleCurrentChange"
                          :page-sizes="[2, 4, 6, 8,10]"
                          :page-size="pageSize"
                          layout="total, sizes, prev, pager, next, jumper"
                          :total="totalcount"
                        ></el-pagination>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="left-220">
              <div class="bg-wrap nobg">
                <div class="sidebar-box">
                  <h4>Êé®ËçêÂïÜÂìÅ</h4>
                  <ul class="side-img-list">
                    <li v-for="(item, index) in hotgoodslist" :key="item.id">
                      <div class="img-box">
                        <router-link :to="'/goodsDetails/'+item.id">
                          <img :src="item.img_url">
                        </router-link>
                      </div>
                      <div class="txt-box">
                        <!-- <a href="#">{{item.title}}</a> -->
                        <router-link :to="'/goodsDetails/'+item.id">{{item.title}}</router-link>
                        <span>{{item.add_time | shortTime}}</span>
                      </div>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- iviewËøîÂõûÈ°∂ÈÉ® -->
    <BackTop>
      <span class="ding">üöÄ</span>
    </BackTop>
  </div>
</template>
<script>
export default {
  name: "Details",
  data() {
    return {
      infoId: "",
      //  ÂïÜÂìÅËØ¶ÊÉÖ
      goodsinfo: {},
      // Êé®ËçêÂïÜÂìÅ
      hotgoodslist: [],
      // ÂïÜÂìÅÂõæÁâáÂàóË°®
      imglist: [],
      // Ë¥≠‰π∞Êï∞Èáè
      buycount:1,
      // tabÊ†èÊòæÁ§∫
      tab: "fist",
      // ËØ∑Ê±ÇÁöÑËØÑËÆ∫ÂÜÖÂÆπ
      contenInof: [],
      // ‰∏öÂÆπÈáè
      pageSize: 4,
      // È°µÁ†Å
      pageIndex: 1,
      // ÊÄªÊù°Êï∞
      totalcount: 7,
      //  Êèê‰∫§ÁöÑËØÑËÆ∫ÂÜÖÂÆπ
      comment: "",
      //   ÊîæÂ§ßÈïúÊï∞ÊçÆ
      images: {
        normal_size: []
      },
      //   ÊîæÂ§ßÈïúÂèÇÊï∞
      zoomerOptions: {
        zoomFactor: 8,
        pane: "container-round",
        hoverDelay: 300,
        namespace: "inline-zoomer",
        move_by_click: true,
        scroll_items: 5,
        choosed_thumb_border_color: "#bbdefb"
      }
    };
  },
  // ÊñπÊ≥ï
  methods: {
    // Ëé∑ÂèñÂïÜÂìÅËØ¶ÊÉÖ
    getDetails() {
      // ÊØèÊ¨°Ê∏≤ÊüìÂâçÈáçÁΩÆËÆ°Êï∞Âô®Êï∞Èáè
      this.buycount=0;
      //   // Ëé∑Âèñurl id
      this.infoId = this.$route.params.id;
      // ËØ∑Ê±ÇÊï∞ÊçÆ
      this.$axios.get(`site/goods/getgoodsinfo/${this.infoId}`).then(resl => {
        // console.log(resl);
        //  ÂïÜÂìÅËØ¶ÊÉÖ
        this.goodsinfo = resl.data.message.goodsinfo;
        // Êé®ËçêÂïÜÂìÅ
        this.hotgoodslist = resl.data.message.hotgoodslist;
        // ÂïÜÂìÅÂõæÁâáÂàóË°®
        this.imglist = resl.data.message.imglist;
        this.images.normal_size = [];
        // Âæ™ÁéØÊ∑ªÂä†Êï∞ÊçÆ 
        this.imglist.forEach(v=>{
              this.images.normal_size.push({
                  id:v.id,
                  url:v.original_path
              })
          })
      });
      //  ÈáçÊñ∞Ëé∑ÂèñËØÑËÆ∫Êï∞ÊçÆ
      this.getPingLun();
    },
    // Ëé∑ÂèñËØÑËÆ∫‰ø°ÊÅØ
    getPingLun() {
      this.$axios
        .get(
          `site/comment/getbypage/goods/${this.infoId}?pageIndex=${
            this.pageIndex
          }&pageSize=${this.pageSize}`
        )
        .then(res => {
          // console.log(res  );
          // ËØÑËÆ∫‰ø°ÊÅØ
          this.contenInof = res.data.message;
          // ËØÑËÆ∫È°µÂÆπÈáè
          this.pageSize = res.data.pageSize;
          // ËØÑËÆ∫ÊÄªÊù°Êï∞
          this.totalcount = res.data.totalcount;
        });
    },
    // ÂàÜÈ°µÁöÑÈ°µÂÆπÈáè‰∫ã‰ª∂
    handleSizeChange(val) {
      // console.log(`ÊØèÈ°µ ${val} Êù°`);
      this.pageSize = val;
      this.getPingLun();
    },

    // ÂàÜÈ°µÁöÑÈ°µÁ†ÅË∑≥ËΩ¨‰∫ã‰ª∂
    handleCurrentChange(val) {
      // console.log(`ÂΩìÂâçÈ°µ: ${val}`);
      this.pageIndex = val;
      this.getPingLun();
    },
    // Ê∑ªÂä†ËØÑËÆ∫
    addPinLun() {
      //   console.log(this.comment);
      if (this.comment == "") {
        this.$message("Âì•‰ª¨ÂÜôÁÇπ‰∏úË•øÂëó!!");
        return;
      }
      //   Êèê‰∫§ÂìÅËÆ∫ÂÜÖÂÆπ
      this.$axios
        .post(`site/validate/comment/post/goods/${this.infoId}`, {
          commenttxt: this.comment
        })
        .then(res => {
          if (res.data.status == 0) {
            //   ÊàêÂäüÊèêÁ§∫
            this.$message({
              message: "ËØÑËÆ∫ÊàêÂäü",
              type: "success"
            });
            // ÈáçÊñ∞Ëé∑Âèñ‰ø°ÊÅØ
            this.getPingLun();
            // Êèê‰∫§ÂÆåÊàêÊ∏ÖÁ©∫ÊñáÊú¨ÂÜÖÂÆπ
            this.comment = "";
          } else {
            //   Â§±Ë¥•ÊèêÁ§∫
            this.$message({
              message: "ËØÑËÆ∫Â§±Ë¥•",
              type: "warning"
            });
          }
        });
    },
    // Ê∑ªÂä†ÂïÜÂìÅ‰∫ã‰ª∂
    add2cart(){
      this.$store.commit('add2cart',{
        goodId:this.infoId,
        goodName:this.buycount,
      })
    }
  
  },
  // ÁîüÂëΩÂë®ÊúüÂáΩÊï∞
  created() {
    // Ê∏≤ÊüìÈ°µÈù¢
    this.getDetails();
    // Ëé∑ÂèñËØÑËÆ∫Êï∞ÊçÆ
    this.getPingLun();
  },
  // ‰æ¶Âê¨Âô®
  watch: {
    $route: function(newvul, oldvul) {
      // ÈáçÊñ∞Ê∏≤ÊüìÈ°µÈù¢
      this.getDetails();
      // ÁõëÂê¨ÂõæÁâáÊï∞ÊçÆ
      this.images.normal_size = [];
    }
  }
};
</script>
<style lang="scss" >
.conten-details {
  // ‰øÆÊîπÂïÜÂìÅ‰ªãÁªçÂ∏ÉÂ±Ä
  .tab-content img {
    display: block;
    max-width: 100%;
  }
  //   ËøîÂõûÈ°∂ÈÉ®Ê†∑Âºè
  .ding {
    font-size: 100px;
    transform: rotateZ(-45deg);
    display: block;
  }
  .inline-zoomer-zoomer-box {
      padding-right: 10px;
    width: 395px;
    .preview-box {
      width: 380px;
      img {
        width: 380px;
      }
    }
    .control-box {
      .thumb-list {
        img {
          width: 100px;
          height: 100px;
        }
      }
    }
  }
}
</style>
